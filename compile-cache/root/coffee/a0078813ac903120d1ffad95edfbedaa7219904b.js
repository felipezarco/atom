(function() {
  var CompositeDisposable;

  CompositeDisposable = require("atom").CompositeDisposable;

  module.exports = {
    subscriptions: null,
    key: "activate-power-mode.particles.colours",
    conf: [],
    golden_ratio_conjugate: 0.618033988749895,
    init: function() {
      this.initConfigSubscribers();
      return this.initList();
    },
    disable: function() {
      var ref, ref1;
      if ((ref = this.subscriptions) != null) {
        ref.dispose();
      }
      if ((ref1 = this.colorList) != null) {
        ref1.dispose();
      }
      return this.colorList = null;
    },
    observe: function(key) {
      return this.subscriptions.add(atom.config.observe(this.key + "." + key, (function(_this) {
        return function(value) {
          return _this.conf[key] = value;
        };
      })(this)));
    },
    initConfigSubscribers: function() {
      this.subscriptions = new CompositeDisposable;
      this.observe('type');
      this.observe('fixed');
      return this.observe('randomType');
    },
    hsvToRgb: function(h, s, v) {
      var c, h2, h3, m, x;
      c = v * s;
      h2 = (360.0 * h) / 60.0;
      h3 = Math.abs((h2 % 2) - 1.0);
      x = c * (1.0 - h3);
      m = v - c;
      if ((0 <= h2 && h2 < 1)) {
        return [c + m, x + m, m];
      }
      if ((1 <= h2 && h2 < 2)) {
        return [x + m, c + m, m];
      }
      if ((2 <= h2 && h2 < 3)) {
        return [m, c + m, x + m];
      }
      if ((3 <= h2 && h2 < 4)) {
        return [m, x + m, c + m];
      }
      if ((4 <= h2 && h2 < 5)) {
        return [x + m, m, c + m];
      }
      if ((5 <= h2 && h2 < 6)) {
        return [c + m, m, x + m];
      }
    },
    getFixedColorGenerator: function*() {
      var c, color;
      c = this.conf['fixed'];
      color = "rgb(" + c.red + "," + c.green + "," + c.blue + ")";
      while (true) {
        yield color;
      }
    },
    getRandomBrightColor: function() {
      var b, g, r, rgb;
      this.seed += this.golden_ratio_conjugate;
      this.seed = this.seed - (Math.floor(this.seed / 1));
      rgb = this.hsvToRgb(this.seed, 1, 1);
      r = Math.floor((rgb[0] * 255) / 1);
      g = Math.floor((rgb[1] * 255) / 1);
      b = Math.floor((rgb[2] * 255) / 1);
      return "rgb(" + r + "," + g + "," + b + ")";
    },
    getRandomAllColor: function() {
      var b, g, r;
      r = Math.floor(Math.random() * 256);
      g = Math.floor(Math.random() * 256);
      b = Math.floor(Math.random() * 256);
      return "rgb(" + r + "," + g + "," + b + ")";
    },
    getRandomGenerator: function*() {
      if (this.conf['randomType'] === 'bright') {
        this.seed = Math.random();
        while (true) {
          yield this.getRandomBrightColor();
        }
      } else {
        while (true) {
          yield this.getRandomAllColor();
        }
      }
    },
    getRandomSpawnGenerator: function*() {
      var color;
      if (this.conf['randomType'] === 'bright') {
        this.seed = Math.random();
        color = this.getRandomBrightColor();
      } else {
        color = this.getRandomAllColor();
      }
      while (true) {
        yield color;
      }
    },
    getColorAtCursorGenerator: function*(cursor, editorElement) {
      var color;
      color = this.getColorAtCursor(cursor, editorElement);
      while (true) {
        yield color;
      }
    },
    getColorAtCursor: function(cursor, editorElement) {
      var el, error, scope;
      scope = cursor.getScopeDescriptor();
      scope = scope.toString().replace(/\./g, '.syntax--');
      try {
        el = editorElement.querySelector(scope);
      } catch (error1) {
        error = error1;
        "rgb(255, 255, 255)";
      }
      if (el) {
        return getComputedStyle(el).color;
      } else {
        return "rgb(255, 255, 255)";
      }
    },
    generateColors: function(cursor, editorElement) {
      var colorType;
      colorType = this.conf['type'];
      if (colorType === 'random') {
        return this.getRandomGenerator();
      } else if (colorType === 'fixed') {
        return this.getFixedColorGenerator();
      } else if (colorType === 'randomSpawn') {
        return this.getRandomSpawnGenerator();
      } else {
        return this.getColorAtCursorGenerator(cursor, editorElement);
      }
    },
    selectColor: function(code) {
      return atom.config.set(this.key + ".type", code);
    },
    initList: function() {
      if (this.colorList != null) {
        return;
      }
      this.colorList = require("./color-list");
      this.colorList.init(this);
      return this.subscriptions.add(atom.commands.add("atom-workspace", {
        "activate-power-mode:select-color": (function(_this) {
          return function() {
            return _this.colorList.toggle();
          };
        })(this)
      }));
    }
  };

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiL2hvbWUvZmVsaXBlLy5hdG9tL3BhY2thZ2VzL2FjdGl2YXRlLXBvd2VyLW1vZGUvbGliL2NvbG9yLWhlbHBlci5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQSxNQUFBOztFQUFDLHNCQUF1QixPQUFBLENBQVEsTUFBUjs7RUFFeEIsTUFBTSxDQUFDLE9BQVAsR0FDRTtJQUFBLGFBQUEsRUFBZSxJQUFmO0lBQ0EsR0FBQSxFQUFLLHVDQURMO0lBRUEsSUFBQSxFQUFNLEVBRk47SUFHQSxzQkFBQSxFQUF3QixpQkFIeEI7SUFLQSxJQUFBLEVBQU0sU0FBQTtNQUNKLElBQUMsQ0FBQSxxQkFBRCxDQUFBO2FBQ0EsSUFBQyxDQUFBLFFBQUQsQ0FBQTtJQUZJLENBTE47SUFTQSxPQUFBLEVBQVMsU0FBQTtBQUNQLFVBQUE7O1dBQWMsQ0FBRSxPQUFoQixDQUFBOzs7WUFDVSxDQUFFLE9BQVosQ0FBQTs7YUFDQSxJQUFDLENBQUEsU0FBRCxHQUFhO0lBSE4sQ0FUVDtJQWNBLE9BQUEsRUFBUyxTQUFDLEdBQUQ7YUFDUCxJQUFDLENBQUEsYUFBYSxDQUFDLEdBQWYsQ0FBbUIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFaLENBQ2QsSUFBQyxDQUFBLEdBQUYsR0FBTSxHQUFOLEdBQVMsR0FETSxFQUNDLENBQUEsU0FBQSxLQUFBO2VBQUEsU0FBQyxLQUFEO2lCQUNoQixLQUFDLENBQUEsSUFBSyxDQUFBLEdBQUEsQ0FBTixHQUFhO1FBREc7TUFBQSxDQUFBLENBQUEsQ0FBQSxJQUFBLENBREQsQ0FBbkI7SUFETyxDQWRUO0lBb0JBLHFCQUFBLEVBQXVCLFNBQUE7TUFDckIsSUFBQyxDQUFBLGFBQUQsR0FBaUIsSUFBSTtNQUNyQixJQUFDLENBQUEsT0FBRCxDQUFTLE1BQVQ7TUFDQSxJQUFDLENBQUEsT0FBRCxDQUFTLE9BQVQ7YUFDQSxJQUFDLENBQUEsT0FBRCxDQUFTLFlBQVQ7SUFKcUIs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QUMsQ0FBQSxTQUFTLENBQUMsSUFBWCxDQUFnQixJQUFoQjthQUVBLElBQUMsQ0FBQSxhQUFhLENBQUMsR0FBZixDQUFtQixJQUFJLENBQUMsUUFBUSxDQUFDLEdBQWQsQ0FBa0IsZ0JBQWxCLEVBQ2pCO1FBQUEsa0NBQUEsRUFBb0MsQ0FBQSxTQUFBLEtBQUE7aUJBQUEsU0FBQTttQkFDbEMsS0FBQyxDQUFBLFNBQVMsQ0FBQyxNQUFYLENBQUE7VUFEa0M7UUFBQSxDQUFBLENBQUEsQ0FBQSxJQUFBLENBQXBDO09BRGlCLENBQW5CO0lBTlEsQ0F4SFY7O0FBSEYiLCJzb3VyY2VzQ29udGVudCI6WyJ7Q29tcG9zaXRlRGlzcG9zYWJsZX0gPSByZXF1aXJlIFwiYXRvbVwiXG5cbm1vZHVsZS5leHBvcnRzID1cbiAgc3Vic2NyaXB0aW9uczogbnVsbFxuICBrZXk6IFwiYWN0aXZhdGUtcG93ZXItbW9kZS5wYXJ0aWNsZXMuY29sb3Vyc1wiXG4gIGNvbmY6IFtdXG4gIGdvbGRlbl9yYXRpb19jb25qdWdhdGU6IDAuNjE4MDMzOTg4NzQ5ODk1XG5cbiAgaW5pdDogLT5cbiAgICBAaW5pdENvbmZpZ1N1YnNjcmliZXJzKClcbiAgICBAaW5pdExpc3QoKVxuXG4gIGRpc2FibGU6IC0+XG4gICAgQHN1YnNjcmlwdGlvbnM/LmRpc3Bvc2UoKVxuICAgIEBjb2xvckxpc3Q/LmRpc3Bvc2UoKVxuICAgIEBjb2xvckxpc3QgPSBudWxsXG5cbiAgb2JzZXJ2ZTogKGtleSkgLT5cbiAgICBAc3Vic2NyaXB0aW9ucy5hZGQgYXRvbS5jb25maWcub2JzZXJ2ZShcbiAgICAgIFwiI3tAa2V5fS4je2tleX1cIiwgKHZhbHVlKSA9PlxuICAgICAgICBAY29uZltrZXldID0gdmFsdWVcbiAgICApXG5cbiAgaW5pdENvbmZpZ1N1YnNjcmliZXJzOiAtPlxuICAgIEBzdWJzY3JpcHRpb25zID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGVcbiAgICBAb2JzZXJ2ZSAndHlwZSdcbiAgICBAb2JzZXJ2ZSAnZml4ZWQnXG4gICAgQG9ic2VydmUgJ3JhbmRvbVR5cGUnXG5cbiAgaHN2VG9SZ2I6IChoLHMsdikgLT4gIyBIU1YgdG8gUkdCIGFsZ29yaXRobSwgYXMgcGVyIHdpa2lwZWRpYVxuICAgIGMgPSB2ICogc1xuICAgIGgyID0gKDM2MC4wKmgpIC82MC4wICMgQWNjb3JkaW5nIHRvIHdpa2lwZWRpYSwgMDxoPDM2MC4uLlxuICAgIGgzID0gTWF0aC5hYnMoKGgyJTIpIC0gMS4wKVxuICAgIHggPSBjICogKDEuMCAtIGgzKVxuICAgIG0gPSB2IC0gY1xuICAgIGlmIDA8PWgyPDEgdGhlbiByZXR1cm4gW2MrbSx4K20sbV1cbiAgICBpZiAxPD1oMjwyIHRoZW4gcmV0dXJuIFt4K20sYyttLG1dXG4gICAgaWYgMjw9aDI8MyB0aGVuIHJldHVybiBbbSxjK20seCttXVxuICAgIGlmIDM8PWgyPDQgdGhlbiByZXR1cm4gW20seCttLGMrbV1cbiAgICBpZiA0PD1oMjw1IHRoZW4gcmV0dXJuIFt4K20sbSxjK21dXG4gICAgaWYgNTw9aDI8NiB0aGVuIHJldHVybiBbYyttLG0seCttXVxuXG4gIGdldEZpeGVkQ29sb3JHZW5lcmF0b3I6IC0+XG4gICAgYyA9IEBjb25mWydmaXhlZCddXG4gICAgY29sb3IgPSBcInJnYigje2MucmVkfSwje2MuZ3JlZW59LCN7Yy5ibHVlfSlcIlxuXG4gICAgbG9vcFxuICAgICAgeWllbGQgY29sb3JcbiAgICByZXR1cm5cblxuICBnZXRSYW5kb21CcmlnaHRDb2xvcjogLT5cbiAgICBAc2VlZCArPSBAZ29sZGVuX3JhdGlvX2Nvbmp1Z2F0ZVxuICAgIEBzZWVkID0gQHNlZWQgLSAoQHNlZWQvLzEpXG4gICAgcmdiID0gQGhzdlRvUmdiKEBzZWVkLDEsMSlcbiAgICByID0gKHJnYlswXSoyNTUpLy8xXG4gICAgZyA9IChyZ2JbMV0qMjU1KS8vMVxuICAgIGIgPSAocmdiWzJdKjI1NSkvLzFcbiAgICBcInJnYigje3J9LCN7Z30sI3tifSlcIlxuXG4gIGdldFJhbmRvbUFsbENvbG9yOiAtPlxuICAgIHIgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyNTYpXG4gICAgZyA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDI1NilcbiAgICBiID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMjU2KVxuICAgIFwicmdiKCN7cn0sI3tnfSwje2J9KVwiXG5cbiAgZ2V0UmFuZG9tR2VuZXJhdG9yOiAtPlxuICAgIGlmIEBjb25mWydyYW5kb21UeXBlJ10gPT0gJ2JyaWdodCdcbiAgICAgIEBzZWVkID0gTWF0aC5yYW5kb20oKVxuXG4gICAgICBsb29wXG4gICAgICAgIHlpZWxkIEBnZXRSYW5kb21CcmlnaHRDb2xvcigpXG4gICAgICByZXR1cm5cblxuICAgIGVsc2VcbiAgICAgIGxvb3BcbiAgICAgICAgeWllbGQgQGdldFJhbmRvbUFsbENvbG9yKClcbiAgICAgIHJldHVyblxuXG4gIGdldFJhbmRvbVNwYXduR2VuZXJhdG9yOiAtPlxuICAgIGlmIEBjb25mWydyYW5kb21UeXBlJ10gPT0gJ2JyaWdodCdcbiAgICAgIEBzZWVkID0gTWF0aC5yYW5kb20oKVxuICAgICAgY29sb3IgPSBAZ2V0UmFuZG9tQnJpZ2h0Q29sb3IoKVxuICAgIGVsc2VcbiAgICAgIGNvbG9yID0gQGdldFJhbmRvbUFsbENvbG9yKClcblxuICAgIGxvb3BcbiAgICAgIHlpZWxkIGNvbG9yXG4gICAgcmV0dXJuXG5cbiAgZ2V0Q29sb3JBdEN1cnNvckdlbmVyYXRvcjogKGN1cnNvciwgZWRpdG9yRWxlbWVudCkgLT5cbiAgICBjb2xvciA9IEBnZXRDb2xvckF0Q3Vyc29yIGN1cnNvciwgZWRpdG9yRWxlbWVudFxuICAgIGxvb3BcbiAgICAgIHlpZWxkIGNvbG9yXG4gICAgcmV0dXJuXG5cbiAgZ2V0Q29sb3JBdEN1cnNvcjogKGN1cnNvciwgZWRpdG9yRWxlbWVudCkgLT5cbiAgICBzY29wZSA9IGN1cnNvci5nZXRTY29wZURlc2NyaXB0b3IoKVxuICAgIHNjb3BlID0gc2NvcGUudG9TdHJpbmcoKS5yZXBsYWNlKC9cXC4vZywgJy5zeW50YXgtLScpXG5cbiAgICB0cnlcbiAgICAgIGVsID0gZWRpdG9yRWxlbWVudC5xdWVyeVNlbGVjdG9yIHNjb3BlXG4gICAgY2F0Y2ggZXJyb3JcbiAgICAgIFwicmdiKDI1NSwgMjU1LCAyNTUpXCJcblxuICAgIGlmIGVsXG4gICAgICBnZXRDb21wdXRlZFN0eWxlKGVsKS5jb2xvclxuICAgIGVsc2VcbiAgICAgIFwicmdiKDI1NSwgMjU1LCAyNTUpXCJcblxuICBnZW5lcmF0ZUNvbG9yczogKGN1cnNvciwgZWRpdG9yRWxlbWVudCkgLT5cbiAgICBjb2xvclR5cGUgPSBAY29uZlsndHlwZSddXG4gICAgaWYgKGNvbG9yVHlwZSA9PSAncmFuZG9tJylcbiAgICAgIHJldHVybiBAZ2V0UmFuZG9tR2VuZXJhdG9yKClcbiAgICBlbHNlIGlmIGNvbG9yVHlwZSA9PSAnZml4ZWQnXG4gICAgICBAZ2V0Rml4ZWRDb2xvckdlbmVyYXRvcigpXG4gICAgZWxzZSBpZiBjb2xvclR5cGUgPT0gJ3JhbmRvbVNwYXduJ1xuICAgICAgQGdldFJhbmRvbVNwYXduR2VuZXJhdG9yKClcbiAgICBlbHNlXG4gICAgICBAZ2V0Q29sb3JBdEN1cnNvckdlbmVyYXRvciBjdXJzb3IsIGVkaXRvckVsZW1lbnRcblxuICBzZWxlY3RDb2xvcjogKGNvZGUpIC0+XG4gICAgYXRvbS5jb25maWcuc2V0KFwiI3tAa2V5fS50eXBlXCIsIGNvZGUpXG5cbiAgaW5pdExpc3Q6IC0+XG4gICAgcmV0dXJuIGlmIEBjb2xvckxpc3Q/XG5cbiAgICBAY29sb3JMaXN0ID0gcmVxdWlyZSBcIi4vY29sb3ItbGlzdFwiXG4gICAgQGNvbG9yTGlzdC5pbml0IHRoaXNcblxuICAgIEBzdWJzY3JpcHRpb25zLmFkZCBhdG9tLmNvbW1hbmRzLmFkZCBcImF0b20td29ya3NwYWNlXCIsXG4gICAgICBcImFjdGl2YXRlLXBvd2VyLW1vZGU6c2VsZWN0LWNvbG9yXCI6ID0+XG4gICAgICAgIEBjb2xvckxpc3QudG9nZ2xlKClcbiJdfQ==
